sudo: required
group: deprecated-2017Q3
services:
- docker
language: node_js
node_js:
- 9.11.1
env:
  global:
  - CC_TEST_REPORTER_ID=f9a7cc51d41f847d9b5c91f469606222755355ec9ea001c6bd7a16d20f45941f
  matrix:
    secure: UGLKVBQBXjxAgL5Oll728ajVCsQFgag/NG5+yKb820PyaZSIi4tmdxWAKCAfey48qNDIPCup0VE4Htgecrez1/JiFacvYBiygM+0hibYUqdr47GJlw4ZoTl7ww93i7thJSB/lj42F85yn7C52d71CWTZC6qE9O3w6OXZIK20WrUl1Q43r2HitXwWJjjsfNtjq/cZ5+/uWLbhYV+bQ/DBKuFvwLduhCmm4AZZIOkxeocwFtif76dHG5r0fWMt1hBDanabhLy/p5gGHN5q8nAnPhHzxP2fqMm0quqHr+UVlwRH3/vQidL+SAequ7xBS8yTR3wvh10Y67T95Kuzzapt4/7dy4fe7FBpQQA6/xo92uHUdXQ2UruHUmSfkiFsBrwyF4FGH2n4SaZ25EQUqj16A2HEpFMphsH9Dbmw//uJDsiQiDy+oXsu/DZ/iA49JzXATEl0BLmQC9i7AiNLNhwcdzvMn/a5EtdpJvEy4iUk+pgeTIUKIQWW6hK+vxPJWZcduB1eMdbvjKABu5xKBpcTXZqjvcJCDdb6fHN4PGM3ppiq5msfFBmEEwGvLgK8Ra/p3VyOdM6mhhYdKB3BEtQUgnzwv33SxtSgOVMOQMHrVpcQtP2oo2WC25yfDyAjOEQQMUjoAKVyp33PoX/7z6BimwlAN5g8WidvvxLqVybwLfQ=
before_script:
- npm install coveralls
- docker-compose -f docker-compose.test.yml up -d
script:
- docker exec -it tropical-hazards-front npm test
after_script:
- "./node_modules/coveralls/bin/coveralls.js < ./test/unit/coverage/lcov.info"
- docker-compose down --remove-orphans
after_success:
- docker login --username=_ --password="$(HEROKU_AUTHTAG)" registry.heroku.com
- docker build -f Dockerfile.prod -t deploy_image .
- echo "$(HEROKU_AUTHTAG)"
- |
  if[ "${TRAVIS_BRANCH}" == "development"]; then 
    echo "Deploying to homolog environment..."  
    docker tag deploy_image registry.heroku.com/tropical-hazards-homolog/web
    docker push registry.heroku.com/tropical-hazards-homolog/web
  else if[ "${TRAVIS_BRANCH}" == "master"]; then
    echo "Deploying to production environment..."
    docker tag deploy_image registry.heroku.com/tropical-hazards/web
    docker push registry.heroku.com/tropical-hazards/web
  else
    echo "Skipping deploy...";
  fi;
  fi;
